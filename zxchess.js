!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.ZXChess=r():t.ZXChess=r()}(this,function(){return function(t){function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}var e={};return r.m=t,r.c=e,r.i=function(t){return t},r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},r.p="",r(r.s=2)}([function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={zxm:function(t,r,e,n){if(!Array.isArray(r))throw new Error("this is not an array:"+r);for(var i=r.length;i--;)if(r[i]===t)return void(void 0===e||null===e?r.splice(i,1):r.splice(i,1,e));return console.log("zxm piece:%s; not found in:%s; insert:%s;",t,JSON.stringify(r),e),!0},trim:function(t){return t.replace(/^\s+|\s+$/,"")},cv:function(t){return"abcdefgh".charAt(7&t)+(1+(t>>4))},vucv:function(t){return 2==t.length&&t.charCodeAt(0)>96&&t.charCodeAt(0)<105&&1*t[1]==t[1]?this.ucv(t):-1},ucv:function(t){return t.charCodeAt(0)-97+16*(t.charAt(1)-1)},zg:function(t){return t.replace(/[^\w\/-]/g," ")},fen:function(t){var r,e,n,i,u,c=this.trim(this.zg(t)),s=c.split(/\s/g),o=0,f={},a=[[[],[],[],[],[],[]],[[],[],[],[],[],[]]];if(6==s.length){var h=s[0].split(/\//);if(8==h.length&&(e=1*s[4],n=1*s[5],i="-"==s[3]?0:this.vucv(s[3]),!(s[0].match(/[^pnbrqk\/1-8]/i)||"wb".indexOf(s[1])<0||"-"!=s[2]&&s[2].match(/[^KQkq]/)||e!=s[4]||e<0||n!=s[5]||n<0||i<0))){r="b"==s[1]?1:0,s[2].indexOf("K")>=0&&(o+=1),s[2].indexOf("Q")>=0&&(o+=2),s[2].indexOf("k")>=0&&(o+=4),s[2].indexOf("q")>=0&&(o+=8),u=2*(n-1)+r;for(var l,p,v,d,g,k,b=0,B=0,O=0,m=8,A=0;m--;){for(d=0,g=0;g<h[m].length;g++)if(1*(k=h[m][g])==k)d+=1*k;else{if(v=d+16*b,l="PNBRQK".indexOf(k)+1)p=0;else{if(!(l="pnbrqk".indexOf(k)+1))return;p=1}if(6==l&&(p&&++O>1||!p&&++B>1))return;f[v]=(A++<<5)+16*p+l,a[p][l-1].push(v),d++}b++}if(B&&O){return{B:f,p:u,k:o,e:i,h:e,z:0,M:[]}}}}},ncn:function(t,r){var e,n="  NBRQK",i=t.m,u=31&i,c=7&u,s=i>>5&127,o=i>>12&127,f=i>>19&7,a=i>>26&1,h=i>>27&1,l=i>>22&1,p=i>>23&1,v="",d=n[c],g=l||p?"x":"",k="",b="";if(e=this.cv(o),h?k="#":a&&(k="+"),6==c){if(i>>24&1)return"O-O"+k;if(i>>25&1)return"O-O-O"+k}else 1==c?(d=l||p?"abcdefgh"[7&s]:"",f&&(v="="+n[f])):r&&(b=this.da(r,s,o,u>>4&1,c));return d+b+g+e+v+k},da:function(t,r,e,n,i){for(var u="87654321",c="abcdefgh",s=t.A[n][i-1],o=s.length,f=[],a=0,h=0,l=7&r,p=r>>4;o--;)s[o]!=r&&this.il(s[o],e,t)&&f.push(s[o]);if(o=f.length){for(;o--;)f[o]>>4==p&&h++,(7&f[o])==l&&a++;return a&&h?c[l]+u[p]:a?u[p]:c[l]}return""}};r.exportFen=function(t){for(var r,e,n=t.B,i=0,u="",c="",s=t.p,o=7;o>-1;o--){i>0&&(c+=i,i=0),o<7&&(c+="/");for(var f=0;f<8;f++)e=n[f+16*o],null==e?i++:(i>0&&(c+=i),i=0,r=" pnbrqk".charAt(7&e),c+=16&e?r:r.toUpperCase())}i>0&&(c+=i),c+=" "+(1&s?"b":"w")+" ";var a=t.k;return 1&a&&(u+="K"),2&a&&(u+="Q"),4&a&&(u+="k"),8&a&&(u+="q"),c+=(""==u?"-":u)+" ",c+=(t.e?this.cv(t.e):"-")+" "+t.h+" "+(Math.floor(s/2)+1)},r.importFen=function(t){return n.fen(t)},r.cv=n.cv,r.ucv=n.ucv},function(t,r,e){"use strict";function n(t){var r=t.B,e=[],n=[];for(var c in r)!function(c){n.push(1*c),u(1*c,t).forEach(function(n){var u=i.setP(1*c,n,t),s=r[c],o=s>>4&1;if(1==(7&s)&&(0==o&&n>>4==7||1==o&&n>>4==0)){var f=i.setP(1*c,n,t),a=i.setP(1*c,n,t),h=i.setP(1*c,n,t);u.B[n]=16*o+8+2,a.B[n]=16*o+8+3,f.B[n]=16*o+8+4,h.B[n]=16*o+8+5,e.push(h),e.push(f),e.push(a)}e.push(u)})}(c);return e}Object.defineProperty(r,"__esModule",{value:!0}),r.everyPossiblePosition=n;var i={A:[0,0,0,0,0,0,0,0,0,40,0,0,0,0,0,0,48,0,0,0,0,0,0,40,0,0,40,0,0,0,0,0,48,0,0,0,0,0,40,0,0,0,0,40,0,0,0,0,48,0,0,0,0,40,0,0,0,0,0,0,40,0,0,0,48,0,0,0,40,0,0,0,0,0,0,0,0,40,0,0,48,0,0,40,0,0,0,0,0,0,0,0,0,0,40,4,48,4,40,0,0,0,0,0,0,0,0,0,0,0,4,104,112,104,4,0,0,0,0,0,0,48,48,48,48,48,48,112,0,112,48,48,48,48,48,48,0,0,0,0,0,0,4,104,112,104,4,0,0,0,0,0,0,0,0,0,0,0,40,4,48,4,40,0,0,0,0,0,0,0,0,0,0,40,0,0,48,0,0,40,0,0,0,0,0,0,0,0,40,0,0,0,48,0,0,0,40,0,0,0,0,0,0,40,0,0,0,0,48,0,0,0,0,40,0,0,0,0,40,0,0,0,0,0,48,0,0,0,0,0,40,0,0,40,0,0,0,0,0,0,48,0,0,0,0,0,0,40,0,0,0,0,0,0,0,0,0],D:[0,0,0,0,0,0,0,0,0,-17,0,0,0,0,0,0,-16,0,0,0,0,0,0,-15,0,0,-17,0,0,0,0,0,-16,0,0,0,0,0,-15,0,0,0,0,-17,0,0,0,0,-16,0,0,0,0,-15,0,0,0,0,0,0,-17,0,0,0,-16,0,0,0,-15,0,0,0,0,0,0,0,0,-17,0,0,-16,0,0,-15,0,0,0,0,0,0,0,0,0,0,-17,-33,-16,-31,-15,0,0,0,0,0,0,0,0,0,0,0,-18,-17,-16,-15,-14,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,14,15,16,17,18,0,0,0,0,0,0,0,0,0,0,0,15,31,16,33,17,0,0,0,0,0,0,0,0,0,0,15,0,0,16,0,0,17,0,0,0,0,0,0,0,0,15,0,0,0,16,0,0,0,17,0,0,0,0,0,0,15,0,0,0,0,16,0,0,0,0,17,0,0,0,0,15,0,0,0,0,0,16,0,0,0,0,0,17,0,0,15,0,0,0,0,0,0,16,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0],M:[[1,16,15,17],[6,-16,-17,-15],[18,33,31,14,-31,-33,-18,-14],[-15,-17,15,17],[-1,-16,1,16],[-15,-17,15,17,-1,-16,1,16]],il:function(t,r,e){var n=e.p,i=1&n,u=e.B,c=u[t];if(c&&(c>>4&1)==i&&this.ip(t,r,e))return this.cl(t,r,e)},cl:function(t,r,e){var n=e.B,i=n[t],u=i>>4&1,c=this.setP(t,r,e),s=this.kl(u,c);if(!this.aa(1^u,s,c))return c},ip:function(t,r,e){switch(7&e.B[t]){case 1:return this.pm(t,r,e);case 6:return 2==Math.abs(r-t)?this.kc(t,r,e):this.ik(t,r,e)}return this.ig(t,r,e)},pm:function(t,r,e){var n=e.B,i=n[t],u=i>>4&1,c=this.M[u],s=c[1];return r==t+s?!n[r]:r==t+s+s?t>>4==c[0]&&!n[t+s]&&!n[r]:r==t+c[2]||r==t+c[3]?this.cc(u,r,n,1)||e.e==r:void 0},ik:function(t,r,e){var n=e.B,i=n[t],u=i>>4&1;return this.A[r-t+128]>>6&1&&this.cc(u,r,n)},kc:function(t,r,e){var n=e.B,i=n[t],u=i>>4&1,c=1^u,s=t>r,o=-2*s+1,f=1<<s<<2*u;if(t==112*u+4&&e.k&f)return!(n[t+o]||n[r]||s&&n[t-3]||this.aa(c,t,e)||this.aa(c,t+o,e))},kl:function(t,r){var e,n=r.B;for(e in n){var i=n[e],u=i>>4&1,c=7&i;if(u===t&&6===c)return 1*e}},cc:function(t,r,e,n){var i=e[r],u=i>>4&1;return i?t!=u:!n},aa:function(t,r,e){var n,i=e.B;for(n in i){if((i[n]>>4&1)===t&&this.ia(1*n,r,e))return 1}},ia:function(t,r,e){var n=e.B,i=n[t],u=7&i;if(1===u){var c=this.M[i>>4&1];return r===t+c[2]||r===t+c[3]}return 6===u?!(136&r)&&this.A[r-t+128]>>u&1:this.ig(t,r,e)},ig:function(t,r,e){var n,i=e.B,u=i[t],c=7&u,s=r-t+128;if(!(136&r)&&this.A[s]>>c&1){if(n=this.D[s],(t+=n)!=r)do{if(i[t])return;t+=n}while(t!=r);return this.cc(u>>4&1,r,i)}},ic:function(t){var r=t.p,e=1&r,n=this.kl(e,t);return this.aa(1^e,n,t)},im:function(t){if(!this.hl(t))return this.ic(t)},is:function(t){if(!this.hl(t))return!this.ic(t)},hl:function(t){var r,e=t.B,n=1&t.p;for(r in e){if((e[r]>>4&1)!==n){if(this.al(1*r,t).length)return 1}}},al:function(t,r){var e,n=r.B,i=n[t],u=i>>4&1,c=7&i,s=1&r.p;if(u==s){switch(c){case 6:e=this.ak(t,r);break;case 1:e=this.ap(t,r);break;default:e=this.ag(t,r)}return this.tm(e,t,r)}return[]},ap:function(t,r){var e=r.B,n=e[t],i=n>>4&1,u=[],c=this.M[i],s=c[1],o=t+c[2],n=t+c[3],f=r.e;return e[t+s]||(u.push(t+s),t>>4!=c[0]||e[t+s+s]||u.push(t+s+s)),136&o||!this.cc(i,o,e,1)&&o!=f||u.push(o),136&n||!this.cc(i,n,e,1)&&n!=f||u.push(n),u},ak:function(t,r){for(var e,n,i=r.B,u=i[t],c=u>>4&1,s=this.M[5],o=8,f=[];o--;)e=s[o],!(136&(n=t+e))&&this.A[n-t+128]>>6&1&&this.cc(c,n,i)&&f.push(n);return this.kc(t,t+2,r)&&f.push(t+2),this.kc(t,t-2,r)&&f.push(t-2),f},ag:function(t,r){for(var e,n,i=r.B,u=i[t],c=u>>4&1,s=7&u,o=this.M[s],f=o.length,a=[];f--;){for(n=o[f],e=t+n;!(136&e)&&this.A[e-t+128]>>s&1&&!i[e];)a.push(e),e+=n;!(136&e)&&this.A[e-t+128]>>s&1&&this.cc(c,e,i)&&a.push(e)}return a},tm:function(t,r,e){for(var n,i,u,c=e.B,s=c[r],o=s>>4&1,f=1^o,a=t.length,h=[];a--;)i=t[a],u=this.setP(r,i,e),n=this.kl(o,u),this.aa(f,n,u)||h.push(t[a]);return h},cp:function(t,r){var e=t.B,n=e[r],i=n>>4&1;return 1==(7&n)&&(!i&&r>>4==7||i&&r>>4==0)},setP:function(t,r,e,n){var i,u,c=e.h+1,s=e.k,o=0,f=this.Bc(e.B),a=f[t],h=a>>4&1,l=7&a,p=f[r],v=e.p+1;switch(p&&(i=1^h,u=(7&p)-1,c=0),f[r]=f[t],delete f[t],l){case 1:c=0,i=h?-16:16,r-t==i+i?o=t+i:r==e.e&&(u=r-i,delete f[u]);break;case 4:h?(119==t&&(s&=11),112==t&&(s&=7)):(7==t&&(s&=14),0==t&&(s&=13));break;case 6:s&=h?3:12,i=r-t,2!=i&&-2!=i||(i>0?(i=r+1,u=r-1):(i=t-4,u=t-1),f[u]=f[i],delete f[i])}return{B:f,p:v,k:s,e:o,h:c,z:0}},Bc:function(t){var r,e={};for(r in t)e[r]=t[r];return e},cv:function(t){return"abcdefgh".charAt(7&t)+(1+(t>>4))},vucv:function(t){return 2==t.length&&t.charCodeAt(0)>96&&t.charCodeAt(0)<105&&1*t[1]==t[1]?this.ucv(t):-1},ucv:function(t){return t.charCodeAt(0)-97+16*(t.charAt(1)-1)}},u=(r.isLegal=function(t,r,e){return i.il(t,r,e)},r.allLegal=function(t,r){return i.al(t,r)});r.isUncheckedPieceMove=function(t,r,e){return i.ip(t,r,e)},r.calculateLegal=function(t,r,e){return i.cl(t,r,e)},r.isUncheckedPawnMove=function(t,r,e){return i.pm(t,r,e)},r.isCheck=function(t){return i.ic(t)},r.hasLegalMove=function(t){return i.hl(t)},r.isLegalCastling=function(t,r,e){return i.kc(t,r,e)}},function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e(1);Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(r,t,{enumerable:!0,get:function(){return n[t]}})});var i=e(0);Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(r,t,{enumerable:!0,get:function(){return i[t]}})})}])});