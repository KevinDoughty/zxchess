!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ZXChess=e():r.ZXChess=e()}(this,function(){return function(r){function e(t){if(n[t])return n[t].exports;var u=n[t]={i:t,l:!1,exports:{}};return r[t].call(u.exports,u,u.exports,e),u.l=!0,u.exports}var n={};return e.m=r,e.c=n,e.i=function(r){return r},e.d=function(r,n,t){e.o(r,n)||Object.defineProperty(r,n,{configurable:!1,enumerable:!0,get:t})},e.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(n,"a",n),n},e.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},e.p="",e(e.s=2)}([function(r,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t={zxm:function(r,e,n,t){if(!Array.isArray(e))throw new Error("this is not an array:"+e);for(var u=e.length;u--;)if(e[u]===r)return void(void 0===n||null===n?e.splice(u,1):e.splice(u,1,n));return console.log("zxm piece:%s; not found in:%s; insert:%s;",r,JSON.stringify(e),n),!0},trim:function(r){return r.replace(/^\s+|\s+$/,"")},cv:function(r){return"abcdefgh".charAt(7&r)+(1+(r>>4))},vucv:function(r){return 2==r.length&&r.charCodeAt(0)>96&&r.charCodeAt(0)<105&&1*r[1]==r[1]?this.ucv(r):-1},ucv:function(r){return r.charCodeAt(0)-97+16*(r.charAt(1)-1)},zg:function(r){return r.replace(/[^\w\/-]/g," ")},fen:function(r){var e,n,t,u,i,o=this.trim(this.zg(r)),f=o.split(/\s/g),c=0,a={},s=[[[],[],[],[],[],[]],[[],[],[],[],[],[]]];if(6==f.length){var h=f[0].split(/\//);if(8==h.length&&(n=1*f[4],t=1*f[5],u="-"==f[3]?0:this.vucv(f[3]),!(f[0].match(/[^pnbrqk\/1-8]/i)||"wb".indexOf(f[1])<0||"-"!=f[2]&&f[2].match(/[^KQkq]/)||n!=f[4]||n<0||t!=f[5]||t<0||u<0))){e="b"==f[1]?1:0,f[2].indexOf("K")>=0&&(c+=1),f[2].indexOf("Q")>=0&&(c+=2),f[2].indexOf("k")>=0&&(c+=4),f[2].indexOf("q")>=0&&(c+=8),i=2*(t-1)+e;for(var l,v,p,d,b,g,B=0,O=0,k=0,x=8,y=0;x--;){for(d=0,b=0;b<h[x].length;b++)if(1*(g=h[x][b])==g)d+=1*g;else{if(p=d+16*B,l="PNBRQK".indexOf(g)+1)v=0;else{if(!(l="pnbrqk".indexOf(g)+1))return;v=1}if(6==l&&(v&&++k>1||!v&&++O>1))return;a[p]=(y++<<5)+16*v+l,s[v][l-1].push(p),d++}B++}if(O&&k){return{B:a,p:i,k:c,e:u,h:n,z:0,M:[]}}}}},ncn:function(r,e){var n,t="  NBRQK",u=r.m,i=31&u,o=7&i,f=u>>5&127,c=u>>12&127,a=u>>19&7,s=u>>26&1,h=u>>27&1,l=u>>22&1,v=u>>23&1,p="",d=t[o],b=l||v?"x":"",g="",B="";if(n=this.cv(c),h?g="#":s&&(g="+"),6==o){if(u>>24&1)return"O-O"+g;if(u>>25&1)return"O-O-O"+g}else 1==o?(d=l||v?"abcdefgh"[7&f]:"",a&&(p="="+t[a])):e&&(B=this.da(e,f,c,i>>4&1,o));return d+B+b+n+p+g},da:function(r,e,n,t,u){for(var i="87654321",o="abcdefgh",f=r.A[t][u-1],c=f.length,a=[],s=0,h=0,l=7&e,v=e>>4;c--;)f[c]!=e&&this.il(f[c],n,r)&&a.push(f[c]);if(c=a.length){for(;c--;)a[c]>>4==v&&h++,(7&a[c])==l&&s++;return s&&h?o[l]+i[v]:s?i[v]:o[l]}return""}};e.exportFen=function(r){for(var e,n,t=r.B,u=0,i="",o="",f=r.p,c=7;c>-1;c--){u>0&&(o+=u,u=0),c<7&&(o+="/");for(var a=0;a<8;a++)n=t[a+16*c],null==n?u++:(u>0&&(o+=u),u=0,e=" pnbrqk".charAt(7&n),o+=16&n?e:e.toUpperCase())}u>0&&(o+=u),o+=" "+(1&f?"b":"w")+" ";var s=r.k;return 1&s&&(i+="K"),2&s&&(i+="Q"),4&s&&(i+="k"),8&s&&(i+="q"),o+=(""==i?"-":i)+" ",o+=(r.e?this.cv(r.e):"-")+" "+r.h+" "+(Math.floor(f/2)+1)},e.importFen=function(r){return t.fen(r)},e.cv=t.cv,e.ucv=t.ucv},function(r,e,n){"use strict";function t(r){var e=r.B,n=[],t=[];for(var u in e)!function(u){t.push(1*u),_(1*u,r).forEach(function(t){var i=M(1*u,t,r),o=e[u],f=o>>4&1;if(1==(7&o)&&(0==f&&t>>4==7||1==f&&t>>4==0)){var c=M(1*u,t,r),a=M(1*u,t,r),s=M(1*u,t,r);i.B[t]=16*f+8+2,a.B[t]=16*f+8+3,c.B[t]=16*f+8+4,s.B[t]=16*f+8+5,n.push(s),n.push(c),n.push(a)}n.push(i)})}(u);return n}Object.defineProperty(e,"__esModule",{value:!0}),e.everyPossiblePosition=t;var u=[0,0,0,0,0,0,0,0,0,40,0,0,0,0,0,0,48,0,0,0,0,0,0,40,0,0,40,0,0,0,0,0,48,0,0,0,0,0,40,0,0,0,0,40,0,0,0,0,48,0,0,0,0,40,0,0,0,0,0,0,40,0,0,0,48,0,0,0,40,0,0,0,0,0,0,0,0,40,0,0,48,0,0,40,0,0,0,0,0,0,0,0,0,0,40,4,48,4,40,0,0,0,0,0,0,0,0,0,0,0,4,104,112,104,4,0,0,0,0,0,0,48,48,48,48,48,48,112,0,112,48,48,48,48,48,48,0,0,0,0,0,0,4,104,112,104,4,0,0,0,0,0,0,0,0,0,0,0,40,4,48,4,40,0,0,0,0,0,0,0,0,0,0,40,0,0,48,0,0,40,0,0,0,0,0,0,0,0,40,0,0,0,48,0,0,0,40,0,0,0,0,0,0,40,0,0,0,0,48,0,0,0,0,40,0,0,0,0,40,0,0,0,0,0,48,0,0,0,0,0,40,0,0,40,0,0,0,0,0,0,48,0,0,0,0,0,0,40,0,0,0,0,0,0,0,0,0],i=[0,0,0,0,0,0,0,0,0,-17,0,0,0,0,0,0,-16,0,0,0,0,0,0,-15,0,0,-17,0,0,0,0,0,-16,0,0,0,0,0,-15,0,0,0,0,-17,0,0,0,0,-16,0,0,0,0,-15,0,0,0,0,0,0,-17,0,0,0,-16,0,0,0,-15,0,0,0,0,0,0,0,0,-17,0,0,-16,0,0,-15,0,0,0,0,0,0,0,0,0,0,-17,-33,-16,-31,-15,0,0,0,0,0,0,0,0,0,0,0,-18,-17,-16,-15,-14,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,14,15,16,17,18,0,0,0,0,0,0,0,0,0,0,0,15,31,16,33,17,0,0,0,0,0,0,0,0,0,0,15,0,0,16,0,0,17,0,0,0,0,0,0,0,0,15,0,0,0,16,0,0,0,17,0,0,0,0,0,0,15,0,0,0,0,16,0,0,0,0,17,0,0,0,0,15,0,0,0,0,0,16,0,0,0,0,0,17,0,0,15,0,0,0,0,0,0,16,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0],o=[[1,16,15,17],[6,-16,-17,-15],[18,33,31,14,-31,-33,-18,-14],[-15,-17,15,17],[-1,-16,1,16],[-15,-17,15,17,-1,-16,1,16]],f=function(r,e,n){var t=n.p,u=1&t,i=n.B,o=i[r];if(o&&(o>>4&1)==u&&a(r,e,n))return c(r,e,n)},c=function(r,e,n){var t=n.B,u=t[r],i=u>>4&1,o=M(r,e,n),f=v(i,o);if(!d(1^i,f,o))return o},a=function(r,e,n){switch(7&n.B[r]){case 1:return s(r,e,n);case 6:return 2==Math.abs(e-r)?l(r,e,n):h(r,e,n)}return g(r,e,n)},s=function(r,e,n){var t=n.B,u=t[r],i=u>>4&1,f=o[i],c=f[1];return e==r+c?!t[e]:e==r+c+c?r>>4==f[0]&&!t[r+c]&&!t[e]:e==r+f[2]||e==r+f[3]?p(i,e,t,1)||n.e==e:void 0},h=function(r,e,n){var t=n.B,i=t[r],o=i>>4&1;return u[e-r+128]>>6&1&&p(o,e,t)},l=function(r,e,n){var t=n.B,u=t[r],i=u>>4&1,o=1^i,f=r>e,c=-2*f+1,a=1<<f<<2*i;if(r==112*i+4&&n.k&a)return!(t[r+c]||t[e]||f&&t[r-3]||d(o,r,n)||d(o,r+c,n))},v=function(r,e){var n,t=e.B;for(n in t){var u=t[n],i=u>>4&1,o=7&u;if(i===r&&6===o)return 1*n}},p=function(r,e,n,t){var u=n[e],i=u>>4&1;return u?r!=i:!t},d=function(r,e,n){var t,u=n.B;for(t in u){if((u[t]>>4&1)===r&&b(1*t,e,n))return 1}},b=function(r,e,n){var t=n.B,i=t[r],f=7&i;if(1===f){var c=o[i>>4&1];return e===r+c[2]||e===r+c[3]}return 6===f?!(136&e)&&u[e-r+128]>>f&1:g(r,e,n)},g=function(r,e,n){var t,o=n.B,f=o[r],c=7&f,a=e-r+128;if(!(136&e)&&u[a]>>c&1){if(t=i[a],(r+=t)!=e)do{if(o[r])return;r+=t}while(r!=e);return p(f>>4&1,e,o)}},B=function(r){var e=r.p,n=1&e,t=v(n,r);return d(1^n,t,r)},O=function(r){var e,n=r.B,t=1&r.p;for(e in n){if((n[e]>>4&1)!==t){if(k(1*e,r).length)return 1}}},k=function(r,e){var n,t=e.B,u=t[r],i=u>>4&1,o=7&u,f=1&e.p;if(i==f){switch(o){case 6:n=y(r,e);break;case 1:n=x(r,e);break;default:n=m(r,e)}return j(n,r,e)}return[]},x=function(r,e){var n=e.B,t=n[r],u=t>>4&1,i=[],f=o[u],c=f[1],a=r+f[2],t=r+f[3],s=e.e;return n[r+c]||(i.push(r+c),r>>4!=f[0]||n[r+c+c]||i.push(r+c+c)),136&a||!p(u,a,n,1)&&a!=s||i.push(a),136&t||!p(u,t,n,1)&&t!=s||i.push(t),i},y=function(r,e){for(var n,t,i=e.B,f=i[r],c=f>>4&1,a=o[5],s=8,h=[];s--;)n=a[s],!(136&(t=r+n))&&u[t-r+128]>>6&1&&p(c,t,i)&&h.push(t);return l(r,r+2,e)&&h.push(r+2),l(r,r-2,e)&&h.push(r-2),h},m=function(r,e){for(var n,t,i=e.B,f=i[r],c=f>>4&1,a=7&f,s=o[a],h=s.length,l=[];h--;){for(t=s[h],n=r+t;!(136&n)&&u[n-r+128]>>a&1&&!i[n];)l.push(n),n+=t;!(136&n)&&u[n-r+128]>>a&1&&p(c,n,i)&&l.push(n)}return l},j=function(r,e,n){for(var t,u,i,o=n.B,f=o[e],c=f>>4&1,a=1^c,s=r.length,h=[];s--;)u=r[s],i=M(e,u,n),t=v(c,i),d(a,t,i)||h.push(r[s]);return h},M=function(r,e,n){var t,u,i=n.h+1,o=n.k,f=0,c=P(n.B),a=c[r],s=a>>4&1,h=7&a,l=c[e],v=n.p+1;switch(l&&(t=1^s,u=(7&l)-1,i=0),c[e]=c[r],delete c[r],h){case 1:i=0,t=s?-16:16,e-r==t+t?f=r+t:e==n.e&&(u=e-t,delete c[u]);break;case 4:s?(119==r&&(o&=11),112==r&&(o&=7)):(7==r&&(o&=14),0==r&&(o&=13));break;case 6:o&=s?3:12,t=e-r,2!=t&&-2!=t||(t>0?(t=e+1,u=e-1):(t=r-4,u=r-1),c[u]=c[t],delete c[t])}return{B:c,p:v,k:o,e:f,h:i,z:0}},P=function(r){var e,n={};for(e in r)n[e]=r[e];return n},_=(e.isLegal=function(r,e,n){return f(r,e,n)},e.allLegal=function(r,e){return k(r,e)});e.isUncheckedPieceMove=function(r,e,n){return a(r,e,n)},e.calculateLegal=function(r,e,n){return c(r,e,n)},e.isUncheckedPawnMove=function(r,e,n){return s(r,e,n)},e.isCheck=function(r){return B(r)},e.hasLegalMove=function(r){return O(r)},e.isLegalCastling=function(r,e,n){return l(r,e,n)}},function(r,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=n(1);Object.keys(t).forEach(function(r){"default"!==r&&"__esModule"!==r&&Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[r]}})});var u=n(0);Object.keys(u).forEach(function(r){"default"!==r&&"__esModule"!==r&&Object.defineProperty(e,r,{enumerable:!0,get:function(){return u[r]}})})}])});